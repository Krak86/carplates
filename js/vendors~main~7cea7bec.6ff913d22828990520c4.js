(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{417:function(e,t,a){"use strict";var i=a(6),n=a(20),r=a(105),o=a(181),s=a(25),c=a(177),d=a(187),l=a(58),h=a(11),u=a(18),p=a(14),g=function(){this.openDone=!1,this.setRequestHeaderDone=!1,this.sendDone=!1,this.abortDone=!1,this.onreadystatechangeCallbackAttached=!1},f=function(){function e(e,t,a){this.completed=!1,this.requestHeadersSize=null,this.requestHeaders=null,this.ttfb=null,this.responseReceivingDuration=null,this.callbackDuration=null,this.ajaxTotalDuration=null,this.aborted=null,this.pageUrl=null,this.requestUrl=null,this.requestSize=0,this.method=null,this.status=null,this.requestSentTime=null,this.responseStartedTime=null,this.responseFinishedTime=null,this.callbackFinishedTime=null,this.endTime=null,this.originalOnreadystatechage=null,this.xhrMonitoringState=new g,this.clientFailure=0,this.CalculateMetrics=function(){this.ajaxTotalDuration=Math.round(1e3*n.c.GetDuration(this.requestSentTime,this.responseFinishedTime))/1e3},this.traceID=e,this.spanID=t,this._logger=a}return e.prototype.getAbsoluteUrl=function(){return this.requestUrl?n.d.getAbsoluteUrl(this.requestUrl):null},e.prototype.getPathName=function(){return this.requestUrl?p.a.sanitizeUrl(this._logger,n.d.getCompleteUrl(this.method,this.requestUrl)):null},e}(),x=(function(){function e(){}e.GetLength=function(e){var t=0;if(!h.a.isNullOrUndefined(e)){var a="";try{a=e.toString()}catch(e){}t=a.length,t=isNaN(t)?0:t}return t}}(),function(){function e(){}return e.AttachEvent=function(e,t,a){var i=!1;return h.a.isNullOrUndefined(e)||(h.a.isNullOrUndefined(e.attachEvent)?h.a.isNullOrUndefined(e.addEventListener)||(e.addEventListener(t,a,!1),i=!0):(e.attachEvent("on"+t,a),i=!0)),i},e.DetachEvent=function(e,t,a){h.a.isNullOrUndefined(e)||(h.a.isNullOrUndefined(e.detachEvent)?h.a.isNullOrUndefined(e.removeEventListener)||e.removeEventListener(t,a,!1):e.detachEvent("on"+t,a))},e}()),m=function(){function e(t,a){this.traceFlag=e.DEFAULT_TRACE_FLAG,this.version=e.DEFAULT_VERSION,t&&e.isValidTraceId(t)?this.traceId=t:this.traceId=n.e.generateW3CId(),a&&e.isValidSpanId(a)?this.spanId=a:this.spanId=n.e.generateW3CId().substr(0,16)}return e.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&"00000000000000000000000000000000"!==e},e.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&"0000000000000000"!==e},e.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},e.DEFAULT_TRACE_FLAG="01",e.DEFAULT_VERSION="00",e}();a.d(t,"a",(function(){return D}));var D=function(){function e(){this.identifier=e.identifier,this.priority=120,this._trackAjaxAttempts=0,this.currentWindowHost="object"==typeof window&&window.location&&window.location.host&&window.location.host.toLowerCase(),this.initialized=!1,this._fetchInitialized=!1}return e.getDefaultConfig=function(){return{maxAjaxCallsPerView:500,disableAjaxTracking:!1,disableFetchTracking:!0,disableCorrelationHeaders:!1,distributedTracingMode:i.a.AI,correlationHeaderExcludedDomains:["*.blob.core.windows.net","*.blob.core.chinacloudapi.cn","*.blob.core.cloudapi.de","*.blob.core.usgovcloudapi.net"],correlationHeaderDomains:void 0,appId:void 0,enableCorsCorrelation:!1,enableRequestHeaderTracking:!1,enableResponseHeaderTracking:!1}},e.getEmptyConfig=function(){return{maxAjaxCallsPerView:void 0,disableAjaxTracking:void 0,disableFetchTracking:void 0,disableCorrelationHeaders:void 0,distributedTracingMode:void 0,correlationHeaderExcludedDomains:void 0,appId:void 0,enableCorsCorrelation:void 0,correlationHeaderDomains:void 0,enableRequestHeaderTracking:void 0,enableResponseHeaderTracking:void 0}},e.getFailedAjaxDiagnosticsMessage=function(e){var t="";try{h.a.isNullOrUndefined(e)||h.a.isNullOrUndefined(e.ajaxData)||h.a.isNullOrUndefined(e.ajaxData.requestUrl)||(t+="(url: '"+e.ajaxData.requestUrl+"')")}catch(e){}return t},e.prototype.trackDependencyData=function(e,t){this.trackDependencyDataInternal(e,t)},e.prototype.processTelemetry=function(e){this._nextPlugin&&this._nextPlugin.processTelemetry&&this._nextPlugin.processTelemetry(e)},e.prototype.setNextPlugin=function(e){e&&(this._nextPlugin=e)},e.prototype.includeCorrelationHeaders=function(e,t,a,i){if(t){if(n.b.canIncludeCorrelationHeader(this._config,e.getAbsoluteUrl(),this.currentWindowHost)){if(a||(a={}),a.headers=new Headers(a.headers||t instanceof Request&&t.headers||{}),this._isUsingAIHeaders){var o="|"+e.traceID+"."+e.spanID;a.headers.set(r.a.requestIdHeader,o),this._config.enableRequestHeaderTracking&&(e.requestHeaders[r.a.requestIdHeader]=o)}if((c=this._config.appId||this._context.appId())&&(a.headers.set(r.a.requestContextHeader,r.a.requestContextAppIdFormat+c),this._config.enableRequestHeaderTracking&&(e.requestHeaders[r.a.requestContextHeader]=r.a.requestContextAppIdFormat+c)),this._isUsingW3CHeaders){var s=new m(e.traceID,e.spanID);a.headers.set(r.a.traceParentHeader,s.toString()),this._config.enableRequestHeaderTracking&&(e.requestHeaders[r.a.traceParentHeader]=s.toString())}return a}return a}if(i){if(this.currentWindowHost&&n.b.canIncludeCorrelationHeader(this._config,i.ajaxData.getAbsoluteUrl(),this.currentWindowHost)){if(this._isUsingAIHeaders){o="|"+i.ajaxData.traceID+"."+i.ajaxData.spanID;i.setRequestHeader(r.a.requestIdHeader,o),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[r.a.requestIdHeader]=o)}var c;if((c=this._config.appId||this._context.appId())&&(i.setRequestHeader(r.a.requestContextHeader,r.a.requestContextAppIdFormat+c),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[r.a.requestContextHeader]=r.a.requestContextAppIdFormat+c)),this._isUsingW3CHeaders){s=new m(i.ajaxData.traceID,i.ajaxData.spanID);i.setRequestHeader(r.a.traceParentHeader,s.toString()),this._config.enableRequestHeaderTracking&&(i.ajaxData.requestHeaders[r.a.traceParentHeader]=s.toString())}}return i}},e.prototype.initialize=function(t,a,n){if(!this.initialized&&!this._fetchInitialized){this._core=a;var r=e.getDefaultConfig();for(var c in this._config=e.getEmptyConfig(),r)this._config[c]=o.a.getConfig(t,c,e.identifier,r[c]);if(this._isUsingAIHeaders=this._config.distributedTracingMode===i.a.AI||this._config.distributedTracingMode===i.a.AI_AND_W3C,this._isUsingW3CHeaders=this._config.distributedTracingMode===i.a.AI_AND_W3C||this._config.distributedTracingMode===i.a.W3C,!1===this._config.disableAjaxTracking&&this.instrumentXhr(),!1===this._config.disableFetchTracking&&this.instrumentFetch(),n.length>0&&n){for(var d=void 0,l=0;!d&&l<n.length;)n[l]&&n[l].identifier===s.b&&(d=n[l]),l++;d&&(this._context=d.context)}}},e.prototype.trackDependencyDataInternal=function(e,t,a){if(-1===this._config.maxAjaxCallsPerView||this._trackAjaxAttempts<this._config.maxAjaxCallsPerView){var i=c.a.create(e,d.a.dataType,d.a.envelopeType,this._core.logger,t,a);this._core.track(i)}else this._trackAjaxAttempts===this._config.maxAjaxCallsPerView&&this._core.logger.throwInternal(u.a.CRITICAL,u.b.MaxAjaxPerPVExceeded,"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.",!0);++this._trackAjaxAttempts},e.prototype.instrumentFetch=function(){if(this.supportsFetch()&&!this._fetchInitialized){var e=window.fetch,t=this;window.fetch=function(a,i){var r;if(t.isFetchInstrumented(a)&&t.isMonitoredInstance(void 0,void 0,a,i))try{r=t.createFetchRecord(a,i),i=t.includeCorrelationHeaders(r,a,i)}catch(e){t._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxOpen,"Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.",{ajaxDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(a),exception:n.e.dump(e)})}return e(a,i).then((function(e){return t.onFetchComplete(e,r),e})).catch((function(e){throw t.onFetchFailed(a,r,e),e}))},this._fetchInitialized=!0}},e.prototype.instrumentXhr=function(){this.supportsAjaxMonitoring()&&!this.initialized&&(this.instrumentOpen(),this.instrumentSend(),this.instrumentAbort(),this.instrumentSetRequestHeader(),this.initialized=!0)},e.prototype.isMonitoredInstance=function(e,t,a,i){var n=!1,r=!0,o=!1;return void 0!==a?(o=this._fetchInitialized,n="object"==typeof a&&!0===a[l.b]||!!i&&!0===i[l.b]):void 0!==e&&(o=this.initialized,n=!0===e[l.b],r=!0===t||!h.a.isNullOrUndefined(e.ajaxData)),o&&r&&!n},e.prototype.supportsAjaxMonitoring=function(){var e=!0;("undefined"==typeof XMLHttpRequest||h.a.isNullOrUndefined(XMLHttpRequest)||h.a.isNullOrUndefined(XMLHttpRequest.prototype)||h.a.isNullOrUndefined(XMLHttpRequest.prototype.open)||h.a.isNullOrUndefined(XMLHttpRequest.prototype.send)||h.a.isNullOrUndefined(XMLHttpRequest.prototype.abort))&&(e=!1);try{" a ".trim()}catch(t){e=!1}return e},e.prototype.instrumentOpen=function(){var t=XMLHttpRequest.prototype.open,a=this;XMLHttpRequest.prototype.open=function(i,r,o){try{!a.isMonitoredInstance(this,!0)||this.ajaxData&&this.ajaxData.xhrMonitoringState.openDone||a.openHandler(this,i,r,o)}catch(t){a._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxOpen,"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(this),exception:n.e.dump(t)})}return t.apply(this,arguments)}},e.prototype.openHandler=function(e,t,a,i){var r=this._context&&this._context.telemetryTrace&&this._context.telemetryTrace.traceID||n.e.generateW3CId(),o=n.e.generateW3CId().substr(0,16),s=new f(r,o,this._core.logger);s.method=t,s.requestUrl=a,s.xhrMonitoringState.openDone=!0,s.requestHeaders={},e.ajaxData=s,this.attachToOnReadyStateChange(e)},e.prototype.instrumentSend=function(){var t=XMLHttpRequest.prototype.send,a=this;XMLHttpRequest.prototype.send=function(i){try{a.isMonitoredInstance(this)&&!this.ajaxData.xhrMonitoringState.sendDone&&a.sendHandler(this,i)}catch(t){a._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxSend,"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(this),exception:n.e.dump(t)})}return t.apply(this,arguments)}},e.prototype.sendHandler=function(e,t){e.ajaxData.requestSentTime=n.c.Now(),(e=this.includeCorrelationHeaders(e.ajaxData,void 0,void 0,e)).ajaxData.xhrMonitoringState.sendDone=!0},e.prototype.instrumentAbort=function(){var t=XMLHttpRequest.prototype.abort,a=this;XMLHttpRequest.prototype.abort=function(){try{a.isMonitoredInstance(this)&&!this.ajaxData.xhrMonitoringState.abortDone&&(this.ajaxData.aborted=1,this.ajaxData.xhrMonitoringState.abortDone=!0)}catch(t){a._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxAbort,"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(this),exception:n.e.dump(t)})}return t.apply(this,arguments)}},e.prototype.instrumentSetRequestHeader=function(){if(this._config.enableRequestHeaderTracking){var t=XMLHttpRequest.prototype.setRequestHeader,a=this;XMLHttpRequest.prototype.setRequestHeader=function(i,r){try{a.isMonitoredInstance(this)&&(this.ajaxData.requestHeaders[i]=r)}catch(t){a._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxSetRequestHeader,"Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(this),exception:n.e.dump(t)})}return t.apply(this,arguments)}}},e.prototype.attachToOnReadyStateChange=function(t){var a=this;t.ajaxData.xhrMonitoringState.onreadystatechangeCallbackAttached=x.AttachEvent(t,"readystatechange",(function(){try{a.isMonitoredInstance(t)&&4===t.readyState&&a.onAjaxComplete(t)}catch(r){var i=n.e.dump(r);i&&-1!==i.toLowerCase().indexOf("c00c023f")||a._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxRSC,"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(t),exception:n.e.dump(r)})}}))},e.prototype.onAjaxComplete=function(t){if(t.ajaxData.responseFinishedTime=n.c.Now(),t.ajaxData.status=t.status,t.ajaxData.CalculateMetrics(),t.ajaxData.ajaxTotalDuration<0)this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxDur,"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(t),requestSentTime:t.ajaxData.requestSentTime,responseFinishedTime:t.ajaxData.responseFinishedTime});else{var a={id:"|"+t.ajaxData.traceID+"."+t.ajaxData.spanID,target:t.ajaxData.getAbsoluteUrl(),name:t.ajaxData.getPathName(),type:"Ajax",duration:t.ajaxData.ajaxTotalDuration,success:+t.ajaxData.status>=200&&+t.ajaxData.status<400,responseCode:+t.ajaxData.status,method:t.ajaxData.method},i=this.getAjaxCorrelationContext(t);if(i&&(a.correlationContext=i),this._config.enableRequestHeaderTracking&&h.a.objKeys(t.ajaxData.requestHeaders).length>0&&(a.properties=a.properties||{},a.properties.requestHeaders={},a.properties.requestHeaders=t.ajaxData.requestHeaders),this._config.enableResponseHeaderTracking){var r=t.getAllResponseHeaders();if(r){var o=r.trim().split(/[\r\n]+/),s={};h.a.arrForEach(o,(function(e){var t=e.split(": "),a=t.shift(),i=t.join(": ");s[a]=i})),h.a.objKeys(s).length>0&&(a.properties=a.properties||{},a.properties.responseHeaders={},a.properties.responseHeaders=s)}}this.trackDependencyDataInternal(a),t.ajaxData=null}},e.prototype.getAjaxCorrelationContext=function(t){try{var a=t.getAllResponseHeaders();if(null!==a)if(-1!==a.toLowerCase().indexOf(r.a.requestContextHeaderLowerCase)){var i=t.getResponseHeader(r.a.requestContextHeader);return n.b.getCorrelationContext(i)}}catch(a){this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{ajaxDiagnosticsMessage:e.getFailedAjaxDiagnosticsMessage(t),exception:n.e.dump(a)})}},e.prototype.isFetchInstrumented=function(e){return this._fetchInitialized&&!0!==e[l.b]},e.prototype.supportsFetch=function(){var e=!0;return("object"!=typeof window||h.a.isNullOrUndefined(window.Request)||h.a.isNullOrUndefined(window.Request.prototype)||h.a.isNullOrUndefined(window.fetch))&&(e=!1),e},e.prototype.createFetchRecord=function(e,t){var a=this._context&&this._context.telemetryTrace&&this._context.telemetryTrace.traceID||n.e.generateW3CId(),i=n.e.generateW3CId().substr(0,16),r=new f(a,i,this._core.logger);return r.requestSentTime=n.c.Now(),e instanceof Request?r.requestUrl=e?e.url:"":r.requestUrl=e,t&&t.method?r.method=t.method:e&&e instanceof Request?r.method=e.method:r.method="GET",t&&t.headers&&this._config.enableRequestHeaderTracking?r.requestHeaders=t.headers:r.requestHeaders={},r},e.prototype.getFailedFetchDiagnosticsMessage=function(e){var t="";try{h.a.isNullOrUndefined(e)||(t+="string"==typeof e?"(url: '"+e+"')":"(url: '"+e.url+"')")}catch(e){this._core.logger.throwInternal(u.a.CRITICAL,u.b.FailedMonitorAjaxOpen,"Failed to grab failed fetch diagnostics message",{exception:n.e.dump(e)})}return t},e.prototype.onFetchComplete=function(e,t){if(t)try{if(t.responseFinishedTime=n.c.Now(),t.CalculateMetrics(),t.ajaxTotalDuration<0)this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxDur,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(e),requestSentTime:t.requestSentTime,responseFinishedTime:t.responseFinishedTime});else{var a={id:"|"+t.traceID+"."+t.spanID,target:t.getAbsoluteUrl(),name:t.getPathName(),type:"Fetch",duration:t.ajaxTotalDuration,success:e.status>=200&&e.status<400,responseCode:e.status,properties:{HttpMethod:t.method}},i=this.getFetchCorrelationContext(e);if(i&&(a.correlationContext=i),this._config.enableRequestHeaderTracking&&h.a.objKeys(t.requestHeaders).length>0&&(a.properties=a.properties||{},a.properties.requestHeaders=t.requestHeaders),this._config.enableResponseHeaderTracking){var r={};e.headers.forEach((function(e,t){r[t]=e})),h.a.objKeys(r).length>0&&(a.properties=a.properties||{},a.properties.responseHeaders=r)}this.trackDependencyDataInternal(a)}}catch(t){this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(e),exception:n.e.dump(t)})}},e.prototype.onFetchFailed=function(e,t,a){if(t)try{if(t.responseFinishedTime=n.c.Now(),t.CalculateMetrics(),t.ajaxTotalDuration<0)this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxDur,"Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(e),requestSentTime:t.requestSentTime,responseFinishedTime:t.responseFinishedTime});else{var i={id:"|"+t.traceID+"."+t.spanID,target:t.getAbsoluteUrl(),name:t.getPathName(),type:"Fetch",duration:t.ajaxTotalDuration,success:!1,responseCode:0,properties:{HttpMethod:t.method}};this.trackDependencyDataInternal(i,{error:a.message})}}catch(t){this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(e),exception:n.e.dump(t)})}},e.prototype.getFetchCorrelationContext=function(e){try{var t=e.headers.get(r.a.requestContextHeader);return n.b.getCorrelationContext(t)}catch(t){this._core.logger.throwInternal(u.a.WARNING,u.b.FailedMonitorAjaxGetCorrelationHeader,"Failed to get Request-Context correlation header as it may be not included in the response or not accessible.",{fetchDiagnosticsMessage:this.getFailedFetchDiagnosticsMessage(e),exception:n.e.dump(t)})}},e.identifier="AjaxDependencyPlugin",e}()}}]);